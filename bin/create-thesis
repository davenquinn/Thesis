#!/usr/bin/env zsh

# https://stmorse.github.io/journal/Thesis-writeup.html

# First we link to the text that comprises each standalone
# chapter. (Note: we assume that the bibliography in each chapter
# is complete and don't try to add to it ourselves)

PROJECTS=$HOME/Development/
SYRTIS=$PROJECTS/Syrtis/versioned/Papers

cd $PROJECT_DIR

build="build"
mkdir -p build

source paper-components/defs.zsh

texfile=build/main.tex

preamble="$build/preamble.tex"
cp source/main.tex $texfile
cat "paper-components/defs/preamble"/*.tex > $preamble
cat chapters/03-statistics/text/math-defs.tex >> $preamble

cat text/abstract.md \
| text-pipeline \
> build/abstract.tex

cat text/acknowledgements.md \
| text-pipeline \
> build/acknowledgements.tex

cat text/introduction.md \
| sed -r 's/^\\section\{(Introduction)\}/\\invisiblesection\{\1\}/g' \
| text-pipeline \
> build/introduction.tex

cat text/conclusion.md \
| sed -r 's/^\\section\{(Introduction)\}/\\invisiblesection\{\1\}/g' \
| text-pipeline \
> build/conclusion.tex

cp $BIBTEX_LIBRARY build/references.bib
run-latex $texfile build/Daven-Quinn-thesis-draft.pdf

for chapter in chapters/*; do
  name=${chapter:t}
  bibtex build/$name/body.aux
done

for chapter in text/*.md; do
  bibtex build/${chapter:t:r}.aux
done

run-latex $texfile build/Daven-Quinn-thesis-draft.pdf

